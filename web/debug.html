<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - SAT Annotator</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { margin: 5px; padding: 10px 15px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>SAT Annotator Debug Tool</h1>
    
    <div class="debug-section">
        <h3>API Connection Test</h3>
        <button onclick="testAPI()">Test API Connection</button>
        <button onclick="testImages()">Test Images Endpoint</button>
        <div id="apiResults"></div>
    </div>

    <div class="debug-section">
        <h3>JavaScript Module Loading</h3>
        <button onclick="testModules()">Test Module Loading</button>
        <div id="moduleResults"></div>
    </div>

    <div class="debug-section">
        <h3>Console Output</h3>
        <div id="consoleOutput"><pre>Check browser console for real-time logs...</pre></div>
    </div>

    <script>
        // Redirect console.log to also show in the page
        const originalLog = console.log;
        const originalError = console.error;
        
        function addToOutput(message, type = 'log') {
            const output = document.getElementById('consoleOutput');
            const div = document.createElement('div');
            div.style.color = type === 'error' ? 'red' : 'black';
            div.style.marginBottom = '5px';
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            addToOutput(args.join(' '), 'log');
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addToOutput(args.join(' '), 'error');
        };

        async function testAPI() {
            const results = document.getElementById('apiResults');
            results.innerHTML = '<p>Testing API connection...</p>';
            
            try {
                const response = await fetch('/');
                if (response.ok) {
                    results.innerHTML = '<div class="success">✅ API connection successful</div>';
                } else {
                    results.innerHTML = '<div class="error">❌ API connection failed: ' + response.status + '</div>';
                }
            } catch (error) {
                results.innerHTML = '<div class="error">❌ API connection error: ' + error.message + '</div>';
            }
        }

        async function testImages() {
            const results = document.getElementById('apiResults');
            results.innerHTML = '<p>Testing images endpoint...</p>';
            
            try {
                const response = await fetch('/api/images/');
                if (response.ok) {
                    const data = await response.json();
                    results.innerHTML = '<div class="success">✅ Images endpoint working. Response: <pre>' + JSON.stringify(data, null, 2) + '</pre></div>';
                } else {
                    results.innerHTML = '<div class="error">❌ Images endpoint failed: ' + response.status + '</div>';
                }
            } catch (error) {
                results.innerHTML = '<div class="error">❌ Images endpoint error: ' + error.message + '</div>';
            }
        }

        function testModules() {
            const results = document.getElementById('moduleResults');
            const modules = [
                'js/utils.js',
                'js/api.js', 
                'js/canvas.js',
                'js/annotations.js',
                'js/app.js'
            ];
            
            results.innerHTML = '<p>Loading modules...</p>';
            
            let moduleResults = '';
            modules.forEach(module => {
                const script = document.createElement('script');
                script.src = module;
                script.onload = () => {
                    moduleResults += `✅ ${module} loaded successfully\n`;
                    results.innerHTML = '<pre>' + moduleResults + '</pre>';
                };
                script.onerror = () => {
                    moduleResults += `❌ ${module} failed to load\n`;
                    results.innerHTML = '<pre>' + moduleResults + '</pre>';
                };
                document.head.appendChild(script);
            });
        }
        
        // Auto-start basic tests
        window.addEventListener('load', () => {
            console.log('Debug page loaded');
            testAPI();
        });
    </script>
</body>
</html>
